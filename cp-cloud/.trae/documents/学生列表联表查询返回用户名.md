## 目标
- 在学生分页查询结果中新增“用户名”字段，来自 `sys_user.user_name`，按学生与用户的关联（`per_student.student_id = sys_user.user_id`）。

## 实现方案
### 1) Mapper 接口新增方法
- 文件：`cp-modules/cp-personnel/src/main/java/com/cp/personnel/mapper/PerStudentMapper.java`
- 增加：
  - `IPage<PerStudentVO> selectStudentPage(Page<?> page, @Param("dto") PerStudentQueryDTO dto)`

### 2) 新建/完善 Mapper XML（联表 + 动态筛选）
- 文件：`cp-modules/cp-personnel/src/main/resources/mapper/personnel/PerStudentMapper.xml`
- 内容要点：
  - 使用联表：`FROM per_student ps LEFT JOIN sys_user u ON u.user_id = ps.student_id`
  - 选择列：`ps.student_id, ps.card_id, ps.student_name, ps.age, ps.sex, ps.phone, ps.stu_class, ps.grade, u.user_name AS userName`
  - 动态条件（示例）：
    - `keyword`：`(ps.card_id LIKE concat('%',#{dto.keyword},'%') OR ps.student_name LIKE ... OR u.user_name LIKE ...)`
    - `grade`：`AND ps.grade = #{dto.grade}`
    - `className`：`AND ps.stu_class = #{dto.className}`
    - （如有软删）`AND ps.del_flag = '0'`
  - 返回 `resultType="com.cp.personnel.domain.vo.PerStudentVO"`
  - 传入 `Page<?> page`，MyBatis-Plus 分页拦截器会自动生成 `COUNT(*)` 与 `LIMIT`

### 3) Service 层改用联表查询
- 文件：`cp-modules/cp-personnel/src/main/java/com/cp/personnel/service/impl/PerStudentServiceImpl.java`
- 更新 `selectStudentPage(PerStudentQueryDTO dto)`：
  - `Page<PerStudent> page = PageUtils.buildPage();`
  - `return perStudentMapper.selectStudentPage(page, dto);`
  - 移除原 `LambdaQueryWrapper` 的单表筛选逻辑（已迁移至 XML 动态条件）

### 4) Controller 保持 DTO 接口
- `PerStudentController.list(PerStudentQueryDTO dto)` 无需改动，继续 `getDataTable(service.selectStudentPage(dto))`

### 5) 配置与校验
- 确认 `mybatis-plus` 的 mapper 扫描包含 `classpath*:mapper/**/*.xml`（如未配置，在 personnel 模块的 `application.yml` 增加该项）
- 构建并运行，验证：
  - 请求：`GET /student/list?pageNum=1&pageSize=10&keyword=张&grade=2022&className=1班`
  - 日志：出现 `SELECT COUNT(*)` 与 `LIMIT`，SQL 有联表与动态条件
  - 响应：`rows` 中包含 `userName` 字段，`total` 为真实总数

## 注意事项
- 避免关键字冲突：前端 `class` 参数已在 DTO 命名为 `className`
- 性能：为 `per_student.student_id`、`sys_user.user_id` 建索引；`keyword` 涉及 `LIKE`，建议必要时使用前缀过滤或全文索引

## 交付
- 我将按上述步骤新增接口方法与 XML，更新 Service，完成构建并提供联表查询的测试日志与示例响应。