# 工具类使用指南

## 简介
- 统一收敛常用能力，提升复用率与一致性，减少重复实现与隐性差异。
- 涵盖网络、校验、字典、日期/表单辅助、滚动、加解密与认证等。

## 目录与职责总览
- `src/utils/auth.ts`：基于 `js-cookie` 的 Token/过期时间读写。
- `src/utils/request.ts`：`axios` 实例封装，统一拦截、错误提示与 GET 参数序列化。
- `src/utils/validate.ts`：常用校验（空值、类型、URL、邮箱、手机号、身份证等）。
- `src/utils/dict.ts`：字典获取与缓存（`useDict`）及值到标签的映射（`useDictMap`）。
- `src/utils/ruoyi.ts`：日期格式化 `parseTime`、表单重置 `resetForm`、时间范围 `addDateRange`、字典标签选择、路径规范化、树形构造、Blob 校验等。
- `src/utils/scroll-to.ts`：平滑滚动到指定位置。
- `src/utils/crypto.ts`：`JSEncrypt` 公私钥演示用加解密（生产谨慎）。

## 快速上手与示例
- 认证
  ```ts
  import { getToken, setToken, removeToken } from '@/utils/auth'
  setToken('token'); const t = getToken(); removeToken()
  ```
- 请求
  ```ts
  import request from '@/utils/request'
  export function getList(params: any) {
    return request({ url: '/demo/list', method: 'get', params })
  }
  ```
- 校验
  ```ts
  import { isPhone, isEmail, isEmpty } from '@/utils/validate'
  if (!isPhone(form.phone)) { /* 提示 */ }
  ```
- 字典
  ```ts
  import { useDict, useDictMap } from '@/utils/dict'
  const { sys_user_sex } = useDict('sys_user_sex')
  const { sys_normal_disable } = useDictMap('sys_normal_disable')
  const label = sys_normal_disable.value['0'] // "启用"
  ```
- 日期与表单
  ```ts
  import { parseTime, addDateRange, resetForm } from '@/utils/ruoyi'
  const s = parseTime(new Date(), '{y}-{m}-{d}')
  const qp = addDateRange({ params: {} }, [begin, end])
  resetForm(formRef)
  ```
- 滚动
  ```ts
  import { scrollTo } from '@/utils/scroll-to'
  scrollTo(0, 300)
  ```
- 加解密（演示）
  ```ts
  import { encrypt, decrypt } from '@/utils/crypto'
  const c = encrypt('abc'); const p = decrypt(c)
  ```

## 统一约定与最佳实践
- 网络层唯一：所有 HTTP 统一走 `utils/request.ts`，页面/模块不自行处理状态码与错误文案。
- GET 参数：仅保留请求拦截器的序列化逻辑，避免双实现（`ruoyi.ts:tansParams` 已移除）。
- 字典一致：页面用 `useDict/useDictMap`，不手工维护常量，保证缓存与展示一致。
- 校验来源：优先使用 `validate.ts` 或 `@vueuse/core`（例如 `useDebounceFn`），避免重复实现。
- 日期格式：统一通过 `parseTime` 输出，项目内保持同一格式策略。
- 命名空间：若项目需要命名空间存储，再启用统一存储工具，避免直用与封装并存。

## 迁移建议清单
- 将状态选择与展示统一替换为 `useDictMap('sys_normal_disable')`。
- 查询页的手机号/邮箱校验接入 `validate.ts`，避免后端报错再提示。
- 翻页体验统一调用 `scrollTo(0, 300)`，保持交互一致。
- 所有接口定义统一 `import request from '@/utils/request'`，移除自定义 `fetch/axios` 实例。

## 常见问题与注意事项
- 加解密：`utils/crypto.ts` 密钥仅用于演示，生产应由后端处理或以安全配置注入，不要在仓库中存储真实密钥。
- Blob 与下载：文件导出接口请先校验响应类型（`blobValidate`），避免错误 JSON 被当作文件保存。
- 组合式字典：`useDict/useDictMap` 返回的是 `ref`，模板中可直接使用，脚本中需 `.value` 访问。
